-- vim: ts=4 sw=4 syntax=lua
--
-- Conky configuration for ArchLinux Package information
--
-- Michael Gilchrist (michaelgilch@gmail.com)

local function get_resolution()

	local handle = io.popen("xrandr | grep '*' | awk '{print $1}' | head -n1")
	if not handle then
		return nil
	end

	-- Read the resolution (something like "1920x1080\n")
	local resolution = handle:read("*a")
	handle:close()

	-- Strip trailing whitespace
	resolution = resolution and resolution:gsub("%s+", "")

	return resolution
end

local function get_hostname()
	local file = io.open("/proc/sys/kernel/hostname", "r")
	local hostname = file and file:read("*l") or "unknown"
	
	if file then 
		file:close() 
	end
	
	return hostname
end

-- Defaults (used by hostname DaVinci with 2K resolution)
local GAP_X 				= 50
local GAP_Y					= 50
local MINIMUM_WIDTH = 300
local MAXIMUM_WIDTH = 600
local FONT					= 'Hack:size=8'

local HOSTNAME = get_hostname()
print("Hostname: ", HOSTNAME)

if HOSTNAME == "galileo" then
	GAP_X 				= 25
	GAP_Y 				= 50
	MINIMUM_WIDTH = 400
	MAXIMUM_WIDTH = 800
	FONT 					= 'Hack:size=10'
end

local resolution = get_resolution()
print("Current Resolution:", resolution)

conky.config = {
	alignment = 'top_left',
	gap_x = GAP_X,
	gap_y = GAP_Y,
	minimum_width = MINIMUM_WIDTH,
	maximum_width = MAXIMUM_WIDTH,
	update_interval = 1,

	background = false,
	use_xft = true,
  font = FONT,
  xftalpha = 1,
	
	own_window = true,
	own_window_type = 'desktop',
	own_window_transparent = true,

	double_buffer = true,
	draw_shades = false,
	draw_outline = false,
	draw_borders = false,

	stippled_borders = 0,
    border_width = 0,
    draw_graph_borders = false,

    default_color = 'FFFFFF',
    color0 = 'FFFFFF',      -- white    (Headings)
    color1 = 'AAAAAA',      -- grey     (Sub-Headings)
    color2 = '1793D1',      -- blue     (Values)
    color3 = 'FFC300',      -- yellow   (Warning)
    color4 = 'FF3300',      -- red      (Urgent)
    color5 = '999999',      -- grey     (Graphs)
    color6 = '999999',      -- grey     (Bars)
}

conky.text = [[
${color0}${execpi 60 ruby ~/git/conky/scripts/package-updates.rb ]] .. HOSTNAME .. [[}

]]
